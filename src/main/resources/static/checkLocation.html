<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" type="text/css" href="/css/main.css">
</head>
<body class="black">

<h2>Adjusting GPS satellites... please standby</h2>
<p id="demo"></p>


<script>
  const x = document.getElementById("demo");

  function getLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(sendLocation, showError);
    } else {
      x.innerHTML = "Geolocation is not supported by this browser.";
    }
  }

  function sendLocation(position) {
    const locationString =
        position.coords.latitude.toFixed(5) + ';' +
        position.coords.longitude.toFixed(5) + ';' +
        new Date().getTime();

    const urlParams = new URLSearchParams(window.location.search);
    const targetUrl = urlParams.get('target') + '/' + crypt(locationString);

    window.location = targetUrl;
  }

  function showError(error) {
    switch (error.code) {
      case error.PERMISSION_DENIED:
        x.innerHTML = "User denied the request for Geolocation."
        break;
      case error.POSITION_UNAVAILABLE:
        x.innerHTML = "Location information is unavailable."
        break;
      case error.TIMEOUT:
        x.innerHTML = "The request to get user location timed out."
        break;
      case error.UNKNOWN_ERROR:
        x.innerHTML = "An unknown error occurred."
        break;
    }
  }

  getLocation();
</script>

<script>
  /*
  Nice, you found your way here. Congrats. But cheating is not really nice, right?
   */
  const ceaserTarget = 'cdef01234567890-ab';
  const ceaserSource = '0123456789abcdef.;';

  function crypt(input) {
    var output = '';
    for (var i = 0; i < input.length; i++) {
      output += ceaserTarget.charAt(ceaserSource.indexOf(input.charAt(i)));
    }
    return output;
  }

</script>
</body>
</html>
